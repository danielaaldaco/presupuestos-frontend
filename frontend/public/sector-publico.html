<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa de MÃ©xico - Sector PÃºblico</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- âœ… Enlace al CSS completo -->
  <link rel="stylesheet" href="styles.css" /> 
  <style>
    /* Ajustes mÃ­nimos para compatibilidad directa si no usas archivo externo */
    html, body { margin: 0; padding: 0; }
    #map { width: 100%; height: 100%; }
  </style>
</head>
<body class="private-body">

    <!-- ===== NAVBAR ===== -->
  <header class="navbar">
    <div class="logo">Papus <span>por MÃ©xico</span></div>
    <nav class="nav-links">
      <a href="index.html">Inicio</a>
      <a href="index.html#sobre-nosotros">Sobre Nosotros</a>
      <a href="sector-publico.html">Sector PÃºblico</a>
      <a href="sector-privado.html" class="active">Sector Privado</a>
      <a href="index.html#contacto">Contacto</a>
    </nav>
  </header>

  <!-- ðŸ”¹ CONTENEDOR PRINCIPAL DEL MAPA -->
  <section class="map-page">
    <div class="map-wrap">
      <div id="map"></div>
      <div class="map-side">
        <h2>Datos del Estado / Ciudad</h2>
        <div class="map-info">
          <p>Haz clic en un estado para ver sus ciudades.</p>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <p>Â© 2025 TransparenciaMX â€” Todos los derechos reservados.</p>
  </footer>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ==================== MAPA ====================

    function darkenColor(hex, percent) {
        var f=parseInt(hex.slice(1),16),
        t=percent<0?0:255,p=percent<0?percent*-1:percent,
        R=f>>16,G=(f>>8)&0x00ff,B=f&0x0000ff;
        return "#"+(0x1000000+(Math.round((t-R)*p)+R)*0x10000
        +(Math.round((t-G)*p)+G)*0x100+(Math.round((t-B)*p)+B))
        .toString(16).slice(1);
    }

    function getRandomColorAndBorder() {
        const colors = ['#4CAF50','#FFD700','#F44336'];
        const base = colors[Math.floor(Math.random()*colors.length)];
        return { fillColor: base, color: darkenColor(base,-0.2), weight: 2, fillOpacity: 0.9 };
    }

    const map = L.map('map').setView([23.6345, -102.5528], 5);
    const capaCiudades = L.layerGroup().addTo(map);

    fetch('estados_mexico.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: getRandomColorAndBorder,
          onEachFeature: (feature, layer) => {
            const nombre = feature.properties.name || "Sin nombre";
            const center = layer.getBounds().getCenter();
            const labelIcon = L.divIcon({
              className: 'state-label-icon',
              html: nombre,
              iconSize: [120,20],
              iconAnchor: [60,10]
            });
            L.marker(center, { icon: labelIcon, interactive:false }).addTo(map);

            layer.on('click', () => {
              map.fitBounds(layer.getBounds());
              cargarCiudades(nombre);
            });
          }
        }).addTo(map);
      })
      .catch(err => alert("Error al cargar estados: " + err));

    function cargarCiudades(estado) {
      capaCiudades.clearLayers();
      const archivos = {
        "Coahuila": "ciudades_coahuila.geojson",
        "Nuevo LeÃ³n": "ciudades_nuevoleon.geojson",
        "Chihuahua": "ciudades_chihuahua.geojson",
        "Jalisco": "ciudades_jalisco.geojson",
        "Sinaloa": "ciudades_sinaloa.geojson",
        "Sonora": "ciudades_sonora.geojson",
        "Durango": "ciudades_durango.geojson",
        "Baja California": "ciudades_bajacalifornia.geojson",
        "Baja California Sur": "ciudades_bajacaliforniasur.geojson",
        "Zacatecas": "ciudades_zacatecas.geojson",
        "Aguascalientes": "ciudades_aguascalientes.geojson",
        "Guanajuato": "ciudades_guanajuato.geojson",
        "QuerÃ©taro": "ciudades_queretaro.geojson",
        "MichoacÃ¡n": "ciudades_michoacan.geojson",
        "Colima": "ciudades_colima.geojson",
        "Nayarit": "ciudades_nayarit.geojson",
        "Tlaxcala": "ciudades_tlaxcala.geojson",
        "YucatÃ¡n": "ciudades_yucatan.geojson",
        "Campeche": "ciudades_campeche.geojson",
        "Quintana Roo": "ciudades_quintanaroo.geojson",
        "Oaxaca": "ciudades_oaxaca.geojson",
        "Chiapas": "ciudades_chiapas.geojson",
        "Veracruz": "ciudades_veracruz.geojson",
        "Morelos": "ciudades_morelos.geojson",
        "Puebla": "ciudades_puebla.geojson",
        "cdmx": "ciudades_cdmx.geojson",
        "Estado de MÃ©xico": "ciudades_mexico.geojson",
        "Tamaulipas": "ciudades_tamaulipas.geojson",
        "Tabasco": "ciudades_tabasco.geojson",
        "San Luis PotosÃ­": "ciudades_sanluis.geojson"

      };
      const archivo = archivos[estado];
      if (!archivo) return;

      fetch(archivo)
        .then(res => res.json())
        .then(data => {
          L.geoJSON(data, {
            pointToLayer: (feature, latlng) => {
              const nombreCiudad = feature.properties.name || "Ciudad";
              return L.circleMarker(latlng, {
                radius: 6, fillColor: "#3388ff", color: "#000",
                weight: 1, opacity: 1, fillOpacity: 0.8
              })
              .bindTooltip(nombreCiudad)
              .on('click', () => {
                document.querySelector('.map-info').innerHTML = `
                  <p><strong>Estado:</strong> ${estado}</p>
                  <p><strong>Ciudad:</strong> ${nombreCiudad}</p>
                `;
              });
            }
          }).addTo(capaCiudades);
        })
        .catch(err => alert("Error al cargar ciudades: " + err));
    }
  </script>
</body>
</html>
